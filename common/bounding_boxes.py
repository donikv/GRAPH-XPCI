import numpy as np
import os
import cv2

bounding_boxes = {
    "38_201-01.2_S1_1950.rec.8bit.tif": [(1200, 2272, 32, 35), (1787, 2075, 125, 215), (1642, 1922, 115, 220), (1687, 1715, 112, 187), (312, 1690, 97, 55), (2347, 1617, 32, 32), (505, 1602, 32, 35), (585, 1550, 55, 45), (1140, 1237, 55, 57), (1347, 1235, 32, 32), (1470, 1070, 35, 32)],
    "38_201-01.2_S1_2000.rec.8bit.tif": [(685, 1900, 42, 42), (1630, 1895, 287, 322), (2122, 1860, 40, 52), (1037, 1725, 35, 32), (1047, 1677, 35, 35), (1675, 1647, 162, 227), (1517, 1085, 35, 32), (1440, 1070, 35, 35), (640, 1025, 52, 50)],
    "38_201-01.2_S1_2050.rec.8bit.tif": [(902, 1960, 62, 67), (1700, 1950, 282, 382), (1657, 1655, 172, 195), (2537, 1480, 80, 142), (635, 1450, 45, 45), (1277, 1327, 130, 82), (2075, 1282, 45, 45), (772, 1105, 72, 67), (2377, 1097, 45, 45)],
    "38_201-01.2_S1_2100.rec.8bit.tif": [(2370, 2145, 105, 92), (755, 1910, 50, 62), (1612, 1820, 407, 422), (1685, 1625, 180, 147), (472, 1547, 75, 47), (2410, 1447, 72, 75), (305, 1335, 52, 55), (617, 1067, 70, 62), (2000, 1050, 202, 102)],
    "38_201-01.2_S2_0050.rec.8bit.tif": [(1642, 1860, 332, 362), (1717, 1625, 142, 155), (1317, 1385, 55, 80), (2482, 1360, 155, 142), (1300, 1315, 55, 55), (1375, 1300, 45, 55), (282, 1172, 92, 100), (882, 1135, 47, 65), (422, 1087, 70, 75), (2082, 975, 187, 165)],
    "38_201-01.2_S2_0100.rec.8bit.tif": [(2315, 2195, 55, 62), (2255, 2117, 42, 50), (1867, 2087, 127, 140), (1835, 1987, 105, 95), (1160, 1747, 62, 65), (1937, 1732, 47, 55), (1342, 1715, 57, 65), (1740, 1650, 102, 160), (2547, 1640, 42, 42), (2645, 1480, 15, 37), (212, 1475, 40, 42), (792, 1440, 42, 42), (285, 1332, 77, 70), (632, 1247, 55, 57), (835, 1227, 77, 67), (500, 1137, 72, 70), (2065, 980, 187, 115), (2325, 977, 82, 65)],
    "49_101-55.5_HA_S2_0700.rec.8bit.tif": [(952, 2092, 210, 90), (1015, 1842, 237, 225), (1127, 1797, 95, 72), (1260, 1752, 45, 45), (1350, 1730, 132, 102), (977, 1617, 472, 165), (275, 1615, 102, 97), (1462, 1587, 132, 112), (1105, 1565, 45, 45), (442, 1435, 175, 160), (165, 1422, 132, 130), (815, 1405, 92, 97), (1845, 1362, 45, 45), (767, 1330, 62, 57), (265, 1325, 80, 72), (855, 1302, 517, 302), (1240, 1295, 422, 280), (595, 1270, 67, 67), (1145, 1260, 77, 170), (435, 1230, 52, 82), (272, 1170, 67, 80), (995, 1167, 152, 117), (1505, 1147, 200, 80), (375, 1140, 117, 100), (577, 1135, 55, 72), (952, 1102, 45, 60), (1580, 1085, 52, 60), (1090, 1085, 75, 77), (1025, 1057, 75, 57), (1490, 1055, 45, 45), (365, 1025, 132, 90), (1490, 1005, 45, 45), (1415, 977, 70, 80), (1167, 957, 272, 317), (580, 865, 122, 152), (1147, 807, 65, 75), (970, 782, 177, 257), (1115, 690, 70, 102), (325, 605, 342, 320), (940, 530, 122, 287), (882, 350, 142, 125)],
    "49_101-55.5_HA_S2_0800.rec.8bit.tif": [(977, 2177, 117, 65), (925, 1810, 135, 100), (1315, 1702, 97, 142), (1545, 1662, 170, 185), (1342, 1622, 50, 72), (1652, 1612, 52, 47), (1107, 1612, 115, 112), (1485, 1587, 57, 45), (210, 1582, 132, 105), (822, 1557, 132, 95), (1425, 1510, 80, 52), (145, 1440, 125, 140), (310, 1432, 282, 337), (1282, 1397, 80, 50), (965, 1390, 307, 190), (1685, 1382, 45, 45), (252, 1357, 55, 50), (1090, 1315, 72, 72), (410, 1312, 195, 230), (222, 1300, 65, 50), (952, 1275, 75, 60), (1605, 1262, 80, 102), (1410, 1260, 132, 175), (985, 1202, 47, 67), (1050, 1187, 52, 102), (1420, 1125, 132, 127), (697, 1095, 115, 232), (415, 1040, 227, 275), (1430, 1032, 95, 87), (1290, 1030, 130, 155), (962, 1027, 397, 297), (380, 980, 137, 132), (1102, 940, 100, 80), (1242, 930, 95, 60), (417, 925, 47, 55), (432, 870, 52, 47), (965, 860, 67, 95), (1037, 852, 70, 92), (320, 852, 67, 120), (565, 845, 180, 170), (902, 767, 75, 65), (985, 750, 100, 97)],
    "49_101-55.5_HA_S2_1200.rec.8bit.tif": [(1152, 2342, 130, 172), (1292, 2330, 90, 65), (800, 2232, 230, 165), (830, 2132, 197, 105), (1077, 2127, 197, 122), (1062, 2110, 67, 55), (1367, 2057, 270, 340), (1370, 2012, 45, 42), (1282, 1967, 45, 45), (1355, 1940, 45, 45), (990, 1910, 62, 47), (1070, 1877, 220, 237), (2347, 1820, 105, 65), (2157, 1817, 95, 85), (1312, 1797, 130, 85), (1220, 1795, 82, 90), (1470, 1765, 95, 125), (2292, 1732, 90, 80), (542, 1660, 105, 107), (940, 1615, 47, 47), (1015, 1555, 142, 137), (787, 1522, 137, 100), (335, 1510, 260, 252), (1282, 1507, 115, 145), (375, 1450, 140, 142), (842, 1432, 60, 72), (1230, 1410, 77, 82), (1260, 1365, 42, 42), (485, 1325, 127, 130), (1392, 1320, 102, 142), (172, 1317, 57, 60), (2232, 1285, 277, 262), (1200, 1207, 77, 135), (725, 1205, 470, 275), (840, 1192, 42, 45), (1050, 1162, 60, 65), (907, 1162, 65, 72), (545, 1120, 60, 152), (880, 1115, 45, 45), (732, 995, 152, 122), (572, 982, 87, 75), (1020, 960, 87, 80), (840, 927, 175, 110), (650, 890, 75, 72), (332, 887, 217, 137), (765, 815, 97, 110), (465, 792, 47, 57), (540, 750, 97, 70), (462, 722, 50, 45)],
    "49_101-55.5_HA_S2_1400.rec.8bit.tif": [(810, 2040, 212, 215), (1125, 1997, 50, 60), (1020, 1865, 265, 182), (2205, 1845, 130, 202), (2392, 1812, 115, 87), (547, 1810, 85, 172), (1375, 1712, 105, 122), (1165, 1695, 62, 57), (1940, 1672, 115, 120), (855, 1607, 82, 97), (2087, 1545, 112, 125), (90, 1460, 132, 207), (1392, 1420, 120, 120), (290, 1415, 207, 370), (440, 1380, 60, 67), (842, 1345, 110, 127), (1960, 1307, 267, 340), (107, 1255, 127, 152), (677, 1237, 170, 167), (620, 1220, 62, 100), (420, 1160, 155, 180), (730, 1150, 112, 67), (650, 1120, 55, 85), (907, 1102, 102, 245), (845, 1030, 67, 77), (747, 1030, 47, 57), (470, 1000, 97, 127), (52, 957, 70, 75), (637, 947, 60, 65), (2150, 942, 142, 142), (700, 935, 62, 77), (257, 832, 155, 112), (420, 815, 82, 85), (1717, 617, 45, 42), (1567, 580, 125, 157), (1765, 492, 192, 180), (1220, 435, 152, 65)],
    "49_101-55.5_HA_S3_0400.rec.8bit.tif": [(1427, 2412, 97, 70), (1532, 2400, 160, 102), (1340, 2355, 62, 47), (1132, 2150, 155, 215), (1825, 2090, 147, 110), (1295, 2090, 517, 305), (1447, 2072, 92, 105), (1255, 2062, 92, 132), (1647, 1927, 160, 130), (1467, 1890, 95, 175), (1952, 1810, 280, 225), (1245, 1795, 142, 107), (1765, 1740, 267, 167), (1247, 1735, 45, 42), (1482, 1730, 207, 145), (1202, 1640, 85, 82), (1925, 1630, 65, 75), (1682, 1527, 212, 162), (92, 1087, 230, 195), (1025, 1002, 125, 115), (425, 672, 65, 67), (142, 500, 252, 95), (427, 475, 65, 60), (502, 450, 60, 50), (167, 417, 45, 45), (82, 380, 45, 45), (1250, 275, 42, 45), (702, 265, 65, 55), (1240, 165, 117, 107), (1297, 120, 42, 42), (880, 0, 160, 190)],
    "49_101-55.5_HA_S3_0600.rec.8bit.tif": [(1205, 2257, 222, 140), (1610, 2247, 87, 65), (2050, 2200, 45, 45), (1320, 2095, 375, 462), (1862, 2015, 45, 47), (1145, 2015, 162, 215), (1507, 2012, 180, 200), (1670, 1997, 172, 127), (1712, 1985, 377, 382), (1300, 1977, 197, 145), (2275, 1942, 45, 45), (2030, 1930, 45, 45), (1862, 1897, 55, 62), (2195, 1887, 45, 45), (1130, 1862, 77, 67), (1225, 1840, 82, 115), (1605, 1780, 142, 92), (1910, 1770, 47, 45), (1340, 1755, 140, 187), (1805, 1722, 45, 45), (1420, 1662, 50, 85), (1850, 1657, 47, 45), (1005, 1347, 70, 52), (800, 1200, 190, 72), (585, 1100, 215, 107), (585, 1060, 65, 57), (860, 1052, 282, 120), (402, 977, 160, 75), (85, 407, 350, 130), (440, 395, 127, 142)],
    "49_101-55.5_HA_S3_0800.rec.8bit.tif": [(1410, 2320, 277, 125), (1542, 2207, 105, 85), (1902, 2102, 55, 55), (1260, 2025, 247, 150), (1140, 1977, 85, 60), (1860, 1905, 57, 50), (1222, 1860, 45, 47), (2010, 1805, 175, 127), (1962, 1740, 82, 105), (2060, 1710, 72, 80), (1370, 1657, 170, 140), (1527, 1652, 132, 95), (1670, 1640, 87, 70), (1645, 1635, 352, 550), (1265, 1570, 97, 235), (635, 1305, 202, 95), (915, 1250, 157, 80), (1057, 1230, 77, 52), (640, 1137, 207, 112), (1300, 1130, 45, 45), (1025, 1122, 212, 75), (275, 1000, 82, 47), (892, 940, 130, 157), (1110, 830, 147, 192), (500, 805, 62, 67), (630, 795, 47, 45), (292, 725, 47, 57), (97, 725, 107, 72), (565, 707, 47, 45), (645, 687, 47, 45), (955, 675, 45, 45), (985, 672, 195, 137), (537, 640, 45, 42), (1055, 627, 42, 45), (1190, 610, 55, 50), (1275, 492, 45, 45), (372, 492, 150, 255), (875, 485, 42, 45), (1157, 440, 115, 147), (895, 335, 65, 52), (802, 325, 45, 42)],

} 

rectangles = {
    "38_201-01.2_S1_1950.rec.8bit.tif": [[[1207, 2280], [1220, 2280], [1220, 2295], [1207, 2295]], [[1767, 2100], [1827, 2075], [1907, 2270], [1847, 2295]], [[1640, 2122], [1675, 1957], [1757, 1972], [1722, 2140]], [[1677, 1942], [1695, 1925], [1712, 1942], [1695, 1960]], [[1687, 1725], [1762, 1712], [1792, 1880], [1720, 1892]], [[382, 1710], [397, 1710], [397, 1725], [382, 1725]], [[342, 1710], [357, 1700], [375, 1727], [360, 1735]], [[320, 1697], [335, 1697], [335, 1712], [320, 1712]], [[2355, 1625], [2367, 1625], [2367, 1637], [2355, 1637]], [[512, 1610], [525, 1610], [525, 1625], [512, 1625]], [[612, 1570], [627, 1570], [627, 1582], [612, 1582]], [[592, 1557], [607, 1557], [607, 1570], [592, 1570]], [[1147, 1267], [1160, 1267], [1160, 1282], [1147, 1282]], [[1167, 1257], [1182, 1257], [1182, 1272], [1167, 1272]], [[1150, 1245], [1162, 1245], [1162, 1260], [1150, 1260]], [[1355, 1242], [1367, 1242], [1367, 1255], [1355, 1255]], [[1477, 1077], [1492, 1077], [1492, 1090], [1477, 1090]]],
    "38_201-01.2_S1_2000.rec.8bit.tif": [[[692, 1907], [715, 1907], [715, 1930], [692, 1930]], [[1562, 1970], [1680, 1882], [1912, 2192], [1797, 2280]], [[2125, 1897], [2135, 1865], [2152, 1867], [2142, 1902]], [[1045, 1732], [1060, 1732], [1060, 1745], [1045, 1745]], [[1677, 1707], [1695, 1690], [1712, 1707], [1695, 1725]], [[1055, 1685], [1070, 1685], [1070, 1700], [1055, 1700]], [[1700, 1860], [1710, 1652], [1830, 1657], [1820, 1867]], [[1525, 1092], [1540, 1092], [1540, 1105], [1525, 1105]], [[1447, 1077], [1462, 1077], [1462, 1092], [1447, 1092]], [[647, 1032], [680, 1032], [680, 1062], [647, 1062]]],
    "38_201-01.2_S1_2050.rec.8bit.tif": [[[910, 1967], [952, 1967], [952, 2015], [910, 2015]], [[1695, 1980], [1762, 1930], [2017, 2275], [1950, 2325]], [[1627, 1772], [1762, 1645], [1842, 1730], [1705, 1857]], [[2540, 1492], [2597, 1485], [2615, 1602], [2557, 1612]], [[642, 1457], [667, 1457], [667, 1482], [642, 1482]], [[1370, 1372], [1395, 1372], [1395, 1397], [1370, 1397]], [[1340, 1372], [1365, 1372], [1365, 1397], [1340, 1397]], [[1280, 1357], [1285, 1330], [1335, 1340], [1327, 1367]], [[2082, 1290], [2107, 1290], [2107, 1315], [2082, 1315]], [[780, 1137], [805, 1137], [805, 1160], [780, 1160]], [[807, 1112], [832, 1112], [832, 1137], [807, 1137]], [[2385, 1105], [2410, 1105], [2410, 1130], [2385, 1130]]],
    "38_201-01.2_S1_2100.rec.8bit.tif": [[[2437, 2200], [2462, 2200], [2462, 2225], [2437, 2225]], [[2367, 2182], [2382, 2145], [2447, 2172], [2432, 2210]], [[757, 1955], [767, 1912], [795, 1917], [782, 1962]], [[1580, 1887], [1655, 1812], [2025, 2190], [1950, 2262]], [[1675, 1675], [1820, 1622], [1862, 1737], [1720, 1792]], [[510, 1560], [535, 1560], [535, 1585], [510, 1585]], [[480, 1555], [505, 1555], [505, 1580], [480, 1580]], [[2417, 1455], [2470, 1455], [2470, 1510], [2417, 1510]], [[312, 1342], [345, 1342], [345, 1377], [312, 1377]], [[625, 1075], [675, 1075], [675, 1117], [625, 1117]], [[2007, 1067], [2160, 1067], [2160, 1140], [2007, 1140]], [[2167, 1057], [2190, 1057], [2190, 1082], [2167, 1082]]],
    "38_201-01.2_S2_0100.rec.8bit.tif": [[[2315, 2207], [2337, 2195], [2362, 2237], [2340, 2250]], [[2262, 2125], [2285, 2125], [2285, 2155], [2262, 2155]], [[1865, 2107], [1962, 2067], [2010, 2177], [1912, 2220]], [[1842, 1995], [1927, 1995], [1927, 2070], [1842, 2070]], [[1167, 1755], [1210, 1755], [1210, 1800], [1167, 1800]], [[1937, 1770], [1952, 1732], [1975, 1742], [1962, 1780]], [[1350, 1722], [1387, 1722], [1387, 1767], [1350, 1767]], [[1735, 1662], [1810, 1650], [1832, 1792], [1757, 1805]], [[2555, 1647], [2577, 1647], [2577, 1670], [2555, 1670]], [[2652, 1487], [2657, 1487], [2657, 1505], [2652, 1505]], [[220, 1482], [240, 1482], [240, 1505], [220, 1505]], [[800, 1447], [822, 1447], [822, 1470], [800, 1470]], [[292, 1340], [350, 1340], [350, 1390], [292, 1390]], [[640, 1255], [675, 1255], [675, 1292], [640, 1292]], [[835, 1252], [855, 1240], [877, 1272], [857, 1287]], [[877, 1235], [900, 1235], [900, 1257], [877, 1257]], [[507, 1145], [560, 1145], [560, 1195], [507, 1195]], [[2070, 1062], [2080, 972], [2247, 992], [2237, 1082]], [[2332, 985], [2395, 985], [2395, 1030], [2332, 1030]]],
    "38_201-01.2_S2_0050.rec.8bit.tif": [[[1632, 1885], [1700, 1825], [1997, 2160], [1927, 2222]], [[1695, 1720], [1825, 1612], [1870, 1667], [1740, 1775]], [[2570, 1440], [2595, 1425], [2630, 1480], [2607, 1497]], [[1325, 1392], [1360, 1392], [1360, 1452], [1325, 1452]], [[2480, 1390], [2497, 1360], [2572, 1402], [2557, 1432]], [[1300, 1345], [1330, 1315], [1347, 1332], [1317, 1362]], [[1382, 1307], [1407, 1307], [1407, 1342], [1382, 1342]], [[282, 1245], [350, 1172], [377, 1200], [312, 1272]], [[890, 1142], [917, 1142], [917, 1187], [890, 1187]], [[430, 1095], [480, 1095], [480, 1150], [430, 1150]], [[2080, 1095], [2112, 960], [2265, 995], [2232, 1130]]],
    "49_101-55.5_HA_S2_0700.rec.8bit.tif": [[[960, 2100], [1150, 2100], [1150, 2170], [960, 2170]], [[1197, 1995], [1240, 1995], [1240, 2055], [1197, 2055]], [[995, 1915], [1027, 1842], [1225, 1930], [1192, 2002]], [[1130, 1807], [1205, 1800], [1210, 1850], [1137, 1857]], [[1357, 1797], [1382, 1797], [1382, 1820], [1357, 1820]], [[1267, 1760], [1292, 1760], [1292, 1785], [1267, 1785]], [[1377, 1790], [1457, 1727], [1490, 1770], [1410, 1832]], [[980, 1715], [1220, 1685], [1230, 1742], [987, 1775]], [[1260, 1692], [1392, 1685], [1395, 1732], [1262, 1737]], [[1400, 1667], [1437, 1667], [1437, 1717], [1400, 1717]], [[1210, 1637], [1235, 1637], [1235, 1660], [1210, 1660]], [[1212, 1680], [1285, 1607], [1315, 1637], [1242, 1710]], [[265, 1675], [337, 1602], [370, 1635], [297, 1707]], [[1467, 1597], [1580, 1590], [1587, 1680], [1475, 1687]], [[1112, 1572], [1137, 1572], [1137, 1597], [1112, 1597]], [[1032, 1567], [1060, 1567], [1060, 1592], [1032, 1592]], [[492, 1560], [542, 1547], [547, 1572], [497, 1585]], [[542, 1502], [585, 1502], [585, 1537], [542, 1537]], [[172, 1485], [215, 1485], [215, 1540], [172, 1540]], [[1222, 1502], [1355, 1475], [1365, 1520], [1232, 1547]], [[1202, 1480], [1225, 1480], [1225, 1505], [1202, 1505]], [[1015, 1455], [1080, 1455], [1080, 1562], [1015, 1562]], [[582, 1450], [605, 1450], [605, 1475], [582, 1475]], [[235, 1447], [285, 1447], [285, 1500], [235, 1500]], [[1367, 1442], [1390, 1442], [1390, 1465], [1367, 1465]], [[447, 1445], [570, 1437], [572, 1490], [450, 1497]], [[1130, 1467], [1137, 1435], [1197, 1442], [1192, 1477]], [[1242, 1437], [1275, 1437], [1275, 1460], [1242, 1460]], [[1210, 1437], [1235, 1437], [1235, 1462], [1210, 1462]], [[192, 1430], [235, 1430], [235, 1477], [192, 1477]], [[815, 1435], [845, 1402], [910, 1467], [880, 1500]], [[1117, 1402], [1140, 1402], [1140, 1427], [1117, 1427]], [[1162, 1395], [1200, 1395], [1200, 1417], [1162, 1417]], [[1600, 1405], [1612, 1382], [1655, 1405], [1640, 1430]], [[1852, 1370], [1877, 1370], [1877, 1395], [1852, 1395]], [[970, 1370], [995, 1370], [995, 1410], [970, 1410]], [[937, 1357], [960, 1357], [960, 1380], [937, 1380]], [[917, 1460], [1095, 1342], [1155, 1435], [980, 1552]], [[1355, 1412], [1572, 1307], [1652, 1475], [1437, 1580]], [[767, 1352], [782, 1327], [825, 1355], [807, 1380]], [[1437, 1335], [1460, 1335], [1460, 1360], [1437, 1360]], [[265, 1350], [292, 1317], [342, 1360], [315, 1392]], [[840, 1357], [872, 1320], [957, 1402], [922, 1437]], [[967, 1312], [1062, 1305], [1065, 1347], [972, 1355]], [[1247, 1302], [1405, 1302], [1405, 1415], [1247, 1415]], [[592, 1310], [635, 1267], [655, 1287], [612, 1330]], [[452, 1275], [475, 1275], [475, 1300], [452, 1300]], [[1152, 1267], [1210, 1267], [1210, 1377], [1152, 1377]], [[1002, 1247], [1030, 1247], [1030, 1272], [1002, 1272]], [[442, 1237], [465, 1237], [465, 1262], [442, 1262]], [[1315, 1242], [1327, 1197], [1432, 1225], [1417, 1272]], [[382, 1205], [405, 1205], [405, 1227], [382, 1227]], [[270, 1227], [300, 1170], [335, 1187], [305, 1245]], [[1007, 1212], [1127, 1165], [1145, 1210], [1025, 1257]], [[1652, 1170], [1692, 1170], [1692, 1200], [1652, 1200]], [[1337, 1162], [1362, 1162], [1362, 1187], [1337, 1187]], [[1510, 1160], [1645, 1152], [1647, 1207], [1512, 1217]], [[387, 1190], [392, 1145], [480, 1152], [477, 1197]], [[585, 1142], [620, 1142], [620, 1195], [585, 1195]], [[1342, 1122], [1365, 1122], [1365, 1147], [1342, 1147]], [[1205, 1117], [1230, 1117], [1230, 1142], [1205, 1142]], [[960, 1110], [985, 1110], [985, 1150], [960, 1150]], [[1582, 1127], [1597, 1085], [1622, 1095], [1607, 1137]], [[1082, 1132], [1127, 1075], [1157, 1100], [1112, 1157]], [[1027, 1085], [1080, 1057], [1095, 1085], [1040, 1112]], [[1497, 1062], [1522, 1062], [1522, 1087], [1497, 1087]], [[372, 1052], [412, 1052], [412, 1102], [372, 1102]], [[412, 1035], [480, 1027], [485, 1077], [417, 1085]], [[1155, 1087], [1180, 1015], [1347, 1072], [1320, 1145]], [[1447, 1020], [1472, 1020], [1472, 1045], [1447, 1045]], [[1497, 1012], [1522, 1012], [1522, 1037], [1497, 1037]], [[1040, 997], [1065, 997], [1065, 1027], [1040, 1027]], [[1422, 985], [1445, 985], [1445, 1010], [1422, 1010]], [[1310, 977], [1335, 977], [1335, 1002], [1310, 1002]], [[1225, 992], [1285, 957], [1310, 1000], [1247, 1035]], [[1067, 935], [1115, 920], [1137, 985], [1087, 1000]], [[580, 1000], [627, 860], [710, 887], [662, 1030]], [[1092, 900], [1110, 855], [1140, 865], [1122, 910]], [[977, 827], [1090, 827], [1090, 1020], [977, 1020]], [[1155, 815], [1200, 815], [1200, 870], [1155, 870]], [[1015, 790], [1040, 790], [1040, 815], [1015, 815]], [[1122, 697], [1172, 697], [1172, 780], [1122, 780]], [[465, 770], [472, 642], [660, 652], [652, 780]], [[325, 905], [377, 602], [500, 625], [447, 927]], [[927, 795], [975, 527], [1052, 540], [1007, 810]], [[882, 442], [1000, 350], [1030, 387], [912, 480]]],
    "49_101-55.5_HA_S2_0800.rec.8bit.tif": [[[980, 2195], [1080, 2180], [1085, 2220], [985, 2235]], [[922, 1852], [962, 1802], [1052, 1875], [1012, 1925]], [[1322, 1710], [1400, 1710], [1400, 1832], [1322, 1832]], [[1552, 1687], [1577, 1687], [1577, 1715], [1552, 1715]], [[307, 1710], [442, 1672], [460, 1735], [322, 1770]], [[1545, 1822], [1570, 1650], [1705, 1670], [1680, 1840]], [[1345, 1680], [1357, 1625], [1385, 1632], [1372, 1685]], [[1660, 1620], [1692, 1620], [1692, 1647], [1660, 1647]], [[1097, 1657], [1140, 1612], [1217, 1690], [1175, 1735]], [[212, 1660], [230, 1592], [282, 1605], [267, 1672]], [[1492, 1595], [1530, 1595], [1530, 1620], [1492, 1620]], [[292, 1590], [330, 1590], [330, 1675], [292, 1675]], [[817, 1595], [835, 1555], [952, 1610], [935, 1650]], [[420, 1652], [550, 1507], [600, 1552], [470, 1697]], [[152, 1522], [180, 1522], [180, 1567], [152, 1567]], [[1432, 1517], [1492, 1517], [1492, 1550], [1432, 1550]], [[1145, 1562], [1147, 1505], [1260, 1510], [1257, 1570]], [[1067, 1495], [1090, 1495], [1090, 1520], [1067, 1520]], [[1025, 1492], [1062, 1492], [1062, 1517], [1025, 1517]], [[1177, 1477], [1202, 1477], [1202, 1502], [1177, 1502]], [[972, 1467], [1025, 1467], [1025, 1505], [972, 1505]], [[1097, 1455], [1140, 1455], [1140, 1487], [1097, 1487]], [[190, 1447], [257, 1447], [257, 1525], [190, 1525]], [[500, 1505], [535, 1432], [570, 1450], [535, 1522]], [[1137, 1427], [1165, 1427], [1165, 1457], [1137, 1457]], [[1320, 1407], [1350, 1407], [1350, 1435], [1320, 1435]], [[1157, 1480], [1170, 1402], [1247, 1415], [1235, 1492]], [[1290, 1405], [1312, 1405], [1312, 1430], [1290, 1430]], [[1065, 1400], [1145, 1395], [1150, 1450], [1070, 1455]], [[1692, 1390], [1717, 1390], [1717, 1415], [1692, 1415]], [[252, 1375], [287, 1357], [300, 1382], [265, 1400]], [[1647, 1330], [1672, 1330], [1672, 1352], [1647, 1352]], [[1097, 1322], [1150, 1322], [1150, 1375], [1097, 1375]], [[397, 1512], [522, 1307], [607, 1360], [482, 1565]], [[1492, 1307], [1530, 1307], [1530, 1340], [1492, 1340]], [[230, 1307], [275, 1307], [275, 1337], [230, 1337]], [[1415, 1420], [1415, 1292], [1475, 1292], [1475, 1420]], [[952, 1297], [1010, 1275], [1022, 1307], [967, 1330]], [[1247, 1275], [1300, 1275], [1300, 1312], [1247, 1312]], [[1612, 1270], [1642, 1270], [1642, 1337], [1612, 1337]], [[1457, 1267], [1507, 1267], [1507, 1310], [1457, 1310]], [[527, 1285], [570, 1237], [602, 1267], [560, 1312]], [[1257, 1237], [1280, 1237], [1280, 1262], [1257, 1262]], [[1295, 1232], [1347, 1232], [1347, 1275], [1295, 1275]], [[1052, 1275], [1065, 1222], [1095, 1230], [1080, 1280]], [[1220, 1210], [1242, 1210], [1242, 1232], [1220, 1232]], [[992, 1210], [1020, 1210], [1020, 1257], [992, 1257]], [[715, 1307], [725, 1197], [800, 1205], [790, 1315]], [[1065, 1195], [1090, 1195], [1090, 1217], [1065, 1217]], [[1127, 1197], [1172, 1160], [1252, 1250], [1210, 1287]], [[705, 1175], [730, 1175], [730, 1200], [705, 1200]], [[1407, 1185], [1485, 1100], [1550, 1162], [1472, 1247]], [[1365, 1120], [1395, 1115], [1405, 1170], [1375, 1175]], [[695, 1105], [725, 1097], [740, 1157], [712, 1165]], [[1025, 1097], [1057, 1097], [1057, 1152], [1025, 1152]], [[412, 1170], [475, 1080], [637, 1195], [575, 1285]], [[960, 1090], [990, 1077], [1020, 1152], [990, 1162]], [[1195, 1080], [1220, 1080], [1220, 1105], [1195, 1105]], [[1445, 1102], [1450, 1067], [1512, 1075], [1510, 1110]], [[512, 1062], [610, 1022], [635, 1082], [535, 1122]], [[1437, 1040], [1460, 1040], [1460, 1065], [1437, 1065]], [[1025, 1067], [1075, 995], [1302, 1152], [1252, 1222]], [[1295, 1100], [1297, 1035], [1407, 1040], [1405, 1105]], [[1200, 1062], [1237, 1015], [1277, 1045], [1240, 1092]], [[410, 1002], [435, 1002], [435, 1027], [410, 1027]], [[375, 1082], [472, 965], [532, 1015], [435, 1132]], [[705, 975], [732, 975], [732, 1002], [705, 1002]], [[582, 985], [585, 960], [632, 965], [630, 990]], [[1110, 947], [1190, 947], [1190, 1007], [1110, 1007]], [[1300, 937], [1325, 937], [1325, 962], [1300, 962]], [[1250, 937], [1285, 937], [1285, 977], [1250, 977]], [[425, 932], [452, 932], [452, 967], [425, 967]], [[985, 892], [1010, 887], [1022, 940], [995, 945]], [[325, 892], [370, 887], [375, 957], [330, 962]], [[440, 877], [472, 877], [472, 905], [440, 905]], [[972, 867], [995, 867], [995, 890], [972, 890]], [[1035, 862], [1082, 850], [1102, 922], [1057, 935]], [[342, 860], [370, 860], [370, 887], [342, 887]], [[532, 902], [605, 832], [720, 952], [647, 1022]], [[1037, 790], [1072, 790], [1072, 835], [1037, 835]], [[900, 792], [940, 755], [970, 787], [927, 825]], [[982, 767], [1005, 750], [1035, 785], [1012, 802]]],
    "49_101-55.5_HA_S2_1200.rec.8bit.tif": [[[1160, 2410], [1270, 2410], [1270, 2502], [1160, 2502]], [[1225, 2350], [1250, 2347], [1255, 2400], [1230, 2402]], [[1295, 2342], [1367, 2332], [1372, 2375], [1300, 2385]], [[1375, 2265], [1402, 2265], [1402, 2312], [1375, 2312]], [[797, 2335], [1010, 2232], [1055, 2327], [842, 2430]], [[1540, 2185], [1620, 2157], [1632, 2195], [1555, 2225]], [[837, 2150], [892, 2150], [892, 2225], [837, 2225]], [[900, 2172], [1002, 2122], [1020, 2157], [920, 2210]], [[1072, 2157], [1257, 2130], [1267, 2212], [1085, 2240]], [[1070, 2117], [1117, 2117], [1117, 2152], [1070, 2152]], [[1377, 2072], [1600, 2062], [1617, 2375], [1395, 2387]], [[1162, 2052], [1275, 2047], [1277, 2097], [1165, 2105]], [[1377, 2017], [1402, 2017], [1402, 2042], [1377, 2042]], [[1110, 2050], [1165, 2007], [1187, 2037], [1132, 2077]], [[1290, 1975], [1315, 1975], [1315, 2000], [1290, 2000]], [[1362, 1947], [1387, 1947], [1387, 1972], [1362, 1972]], [[997, 1917], [1040, 1917], [1040, 1945], [997, 1945]], [[1072, 2005], [1085, 1880], [1237, 1892], [1225, 2020]], [[2157, 1882], [2165, 1842], [2245, 1860], [2235, 1897]], [[1470, 1870], [1500, 1825], [1522, 1842], [1495, 1885]], [[2355, 1830], [2380, 1830], [2380, 1855], [2355, 1855]], [[2385, 1827], [2440, 1827], [2440, 1872], [2385, 1872]], [[2215, 1825], [2240, 1825], [2240, 1850], [2215, 1850]], [[1320, 1805], [1430, 1805], [1430, 1870], [1320, 1870]], [[1210, 1817], [1262, 1790], [1295, 1847], [1242, 1877]], [[2345, 1775], [2370, 1775], [2370, 1800], [2345, 1800]], [[1477, 1772], [1552, 1772], [1552, 1822], [1477, 1822]], [[2297, 1785], [2305, 1735], [2330, 1740], [2322, 1790]], [[542, 1740], [597, 1700], [617, 1725], [560, 1765]], [[595, 1667], [635, 1667], [635, 1702], [595, 1702]], [[947, 1622], [975, 1622], [975, 1650], [947, 1650]], [[887, 1575], [912, 1575], [912, 1600], [887, 1600]], [[1002, 1635], [1135, 1552], [1170, 1612], [1037, 1695]], [[792, 1607], [797, 1557], [822, 1560], [817, 1610]], [[457, 1547], [485, 1547], [485, 1580], [457, 1580]], [[840, 1530], [897, 1530], [897, 1565], [840, 1565]], [[332, 1737], [530, 1485], [627, 1562], [430, 1815]], [[1275, 1530], [1312, 1500], [1402, 1617], [1365, 1647]], [[365, 1542], [440, 1480], [467, 1512], [392, 1575]], [[437, 1460], [480, 1450], [505, 1542], [462, 1552]], [[842, 1445], [870, 1432], [892, 1485], [865, 1497]], [[1022, 1452], [1035, 1422], [1090, 1445], [1077, 1475]], [[2225, 1490], [2315, 1417], [2367, 1485], [2277, 1555]], [[1232, 1420], [1290, 1415], [1295, 1475], [1237, 1480]], [[1000, 1410], [1025, 1410], [1025, 1435], [1000, 1435]], [[1090, 1387], [1182, 1387], [1182, 1465], [1090, 1465]], [[1267, 1372], [1290, 1372], [1290, 1395], [1267, 1395]], [[1400, 1367], [1425, 1367], [1425, 1392], [1400, 1392]], [[465, 1387], [537, 1325], [610, 1410], [537, 1472]], [[1410, 1442], [1442, 1322], [1497, 1337], [1465, 1457]], [[180, 1325], [217, 1325], [217, 1365], [180, 1365]], [[2315, 1422], [2462, 1252], [2527, 1310], [2382, 1480]], [[1210, 1287], [1265, 1287], [1265, 1330], [1210, 1330]], [[872, 1290], [920, 1270], [997, 1452], [947, 1472]], [[717, 1350], [735, 1257], [885, 1287], [867, 1380]], [[975, 1372], [997, 1242], [1055, 1250], [1030, 1382]], [[1207, 1215], [1232, 1215], [1232, 1267], [1207, 1267]], [[977, 1212], [1000, 1212], [1000, 1237], [977, 1237]], [[847, 1200], [870, 1200], [870, 1225], [847, 1225]], [[1057, 1170], [1097, 1170], [1097, 1215], [1057, 1215]], [[915, 1170], [960, 1170], [960, 1222], [915, 1222]], [[545, 1127], [577, 1122], [600, 1255], [570, 1262]], [[887, 1122], [912, 1122], [912, 1147], [887, 1147]], [[740, 1045], [810, 1045], [810, 1105], [740, 1105]], [[580, 1022], [605, 1022], [605, 1045], [580, 1045]], [[790, 1032], [807, 995], [877, 1025], [862, 1062]], [[950, 1007], [995, 982], [1007, 1007], [962, 1032]], [[622, 990], [647, 990], [647, 1015], [622, 1015]], [[450, 987], [475, 987], [475, 1012], [450, 1012]], [[492, 970], [537, 970], [537, 1005], [492, 1005]], [[1020, 975], [1090, 962], [1100, 1015], [1032, 1030]], [[922, 960], [947, 960], [947, 985], [922, 985]], [[332, 952], [432, 935], [445, 997], [342, 1015]], [[940, 945], [962, 927], [997, 970], [977, 987]], [[840, 952], [880, 925], [915, 977], [877, 1005]], [[452, 907], [477, 907], [477, 932], [452, 932]], [[677, 945], [690, 900], [715, 905], [705, 952]], [[657, 897], [682, 897], [682, 922], [657, 922]], [[410, 895], [435, 895], [435, 940], [410, 940]], [[755, 892], [815, 822], [855, 857], [797, 927]], [[797, 822], [820, 822], [820, 847], [797, 847]], [[472, 800], [500, 800], [500, 837], [472, 837]], [[602, 782], [625, 782], [625, 807], [602, 807]], [[547, 772], [572, 772], [572, 797], [547, 797]], [[575, 757], [602, 757], [602, 782], [575, 782]], [[470, 730], [500, 730], [500, 755], [470, 755]]],
    "49_101-55.5_HA_S2_1400.rec.8bit.tif": [[[812, 2237], [817, 2075], [985, 2080], [980, 2242]], [[862, 2047], [1010, 2047], [1010, 2122], [862, 2122]], [[1132, 2005], [1162, 2005], [1162, 2045], [1132, 2045]], [[1192, 1967], [1200, 1935], [1275, 1950], [1270, 1982]], [[580, 1940], [607, 1927], [625, 1962], [597, 1975]], [[990, 1985], [1150, 1837], [1220, 1912], [1060, 2060]], [[2205, 2030], [2220, 1850], [2327, 1857], [2315, 2037]], [[2400, 1820], [2495, 1820], [2495, 1887], [2400, 1887]], [[555, 1817], [612, 1817], [612, 1942], [555, 1942]], [[1365, 1805], [1422, 1707], [1472, 1737], [1415, 1835]], [[1172, 1702], [1215, 1702], [1215, 1740], [1172, 1740]], [[1937, 1757], [2007, 1665], [2057, 1700], [1987, 1795]], [[845, 1632], [895, 1607], [927, 1677], [877, 1700]], [[2062, 1622], [2120, 1527], [2192, 1572], [2135, 1667]], [[1447, 1492], [1470, 1467], [1512, 1510], [1487, 1532]], [[80, 1642], [115, 1457], [217, 1477], [182, 1662]], [[1400, 1427], [1447, 1427], [1447, 1505], [1400, 1505]], [[295, 1770], [302, 1420], [485, 1422], [480, 1775]], [[447, 1387], [487, 1387], [487, 1435], [447, 1435]], [[825, 1370], [902, 1335], [945, 1432], [870, 1467]], [[1922, 1582], [2170, 1285], [2240, 1345], [1992, 1642]], [[630, 1265], [667, 1265], [667, 1307], [630, 1307]], [[92, 1302], [177, 1250], [250, 1367], [165, 1420]], [[657, 1372], [735, 1235], [850, 1300], [772, 1437]], [[627, 1227], [670, 1227], [670, 1257], [627, 1257]], [[737, 1182], [760, 1182], [760, 1205], [737, 1205]], [[415, 1250], [520, 1157], [597, 1242], [490, 1337]], [[657, 1162], [690, 1162], [690, 1192], [657, 1192]], [[775, 1165], [827, 1152], [832, 1177], [780, 1190]], [[667, 1127], [692, 1127], [692, 1152], [667, 1152]], [[905, 1327], [935, 1105], [1007, 1115], [977, 1337]], [[852, 1037], [900, 1037], [900, 1095], [852, 1095]], [[755, 1037], [782, 1037], [782, 1075], [755, 1075]], [[472, 1007], [535, 995], [560, 1110], [495, 1122]], [[60, 995], [85, 995], [85, 1020], [60, 1020]], [[57, 982], [70, 957], [115, 980], [102, 1002]], [[637, 985], [675, 947], [695, 967], [657, 1005]], [[2130, 1027], [2257, 937], [2297, 992], [2170, 1085]], [[695, 987], [722, 937], [755, 952], [730, 1005]], [[247, 895], [380, 822], [417, 892], [285, 962]], [[410, 862], [467, 807], [497, 840], [440, 895]], [[1575, 650], [1600, 650], [1600, 672], [1575, 672]], [[1725, 625], [1750, 625], [1750, 647], [1725, 647]], [[1592, 722], [1605, 585], [1685, 592], [1672, 730]], [[1760, 537], [1900, 492], [1950, 655], [1810, 700]], [[1227, 442], [1360, 442], [1360, 487], [1227, 487]]],
    "49_101-55.5_HA_S3_0400.rec.8bit.tif": [[[1435, 2420], [1512, 2420], [1512, 2470], [1435, 2470]], [[1530, 2450], [1547, 2392], [1690, 2437], [1672, 2495]], [[1347, 2362], [1390, 2362], [1390, 2390], [1347, 2390]], [[1687, 2290], [1775, 2260], [1785, 2290], [1697, 2317]], [[1575, 2312], [1632, 2247], [1737, 2345], [1680, 2407]], [[1290, 2255], [1335, 2170], [1590, 2297], [1545, 2382]], [[1645, 2192], [1757, 2150], [1782, 2217], [1672, 2260]], [[1125, 2170], [1210, 2132], [1297, 2327], [1212, 2365]], [[1262, 2127], [1312, 2127], [1312, 2182], [1262, 2182]], [[1822, 2180], [1832, 2092], [1962, 2110], [1952, 2195]], [[1735, 2105], [1777, 2092], [1802, 2182], [1760, 2195]], [[1442, 2097], [1490, 2062], [1545, 2137], [1497, 2172]], [[1285, 2077], [1310, 2060], [1340, 2102], [1317, 2120]], [[1655, 1950], [1680, 1950], [1680, 1977], [1655, 1977]], [[1665, 2007], [1712, 1905], [1802, 1947], [1755, 2047]], [[1955, 1947], [1962, 1920], [2032, 1937], [2025, 1965]], [[2012, 1907], [2037, 1907], [2037, 1930], [2012, 1930]], [[1470, 1902], [1540, 1890], [1567, 2040], [1497, 2055]], [[1322, 1830], [1357, 1815], [1380, 1867], [1347, 1882]], [[2035, 1940], [2157, 1777], [2277, 1867], [2155, 2030]], [[1245, 1885], [1265, 1795], [1320, 1807], [1300, 1897]], [[1975, 1792], [2005, 1782], [2025, 1837], [1995, 1850]], [[1760, 1852], [1970, 1722], [2022, 1807], [1812, 1937]], [[1255, 1742], [1280, 1742], [1280, 1765], [1255, 1765]], [[1487, 1742], [1675, 1735], [1680, 1860], [1492, 1865]], [[1197, 1700], [1237, 1637], [1285, 1667], [1247, 1730]], [[1922, 1645], [1945, 1630], [1982, 1685], [1957, 1700]], [[1680, 1632], [1707, 1522], [1905, 1570], [1877, 1680]], [[85, 1107], [175, 1042], [320, 1237], [232, 1302]], [[1017, 1072], [1087, 1005], [1150, 1067], [1080, 1135]], [[422, 692], [442, 672], [485, 715], [465, 735]], [[147, 507], [380, 502], [382, 575], [150, 582]], [[435, 482], [480, 482], [480, 522], [435, 522]], [[510, 457], [550, 457], [550, 487], [510, 487]], [[175, 425], [200, 425], [200, 450], [175, 450]], [[90, 387], [115, 387], [115, 412], [90, 412]], [[1257, 282], [1280, 282], [1280, 307], [1257, 307]], [[710, 272], [755, 272], [755, 307], [710, 307]], [[1240, 250], [1260, 212], [1285, 225], [1265, 262]], [[1295, 197], [1320, 197], [1320, 220], [1295, 220]], [[1320, 172], [1345, 172], [1345, 197], [1320, 197]], [[1305, 127], [1327, 127], [1327, 150], [1305, 150]], [[870, 165], [900, -17], [1032, 2], [1002, 185]]],
    "49_101-55.5_HA_S3_0600.rec.8bit.tif": [[[1390, 2512], [1410, 2457], [1437, 2467], [1420, 2522]], [[1535, 2502], [1632, 2445], [1672, 2510], [1572, 2570]], [[1380, 2462], [1482, 2380], [1552, 2467], [1452, 2550]], [[1537, 2350], [1680, 2345], [1682, 2442], [1540, 2445]], [[1182, 2335], [1215, 2257], [1425, 2352], [1392, 2427]], [[1610, 2282], [1622, 2245], [1690, 2270], [1675, 2307]], [[1390, 2267], [1475, 2217], [1537, 2320], [1452, 2370]], [[1357, 2227], [1385, 2227], [1385, 2255], [1357, 2255]], [[1405, 2210], [1430, 2210], [1430, 2235], [1405, 2235]], [[2057, 2207], [2082, 2207], [2082, 2232], [2057, 2232]], [[1370, 2187], [1395, 2187], [1395, 2212], [1370, 2212]], [[1317, 2177], [1342, 2162], [1367, 2205], [1345, 2220]], [[1247, 2167], [1270, 2167], [1270, 2190], [1247, 2190]], [[1210, 2167], [1235, 2165], [1242, 2215], [1215, 2217]], [[1507, 2160], [1530, 2115], [1557, 2130], [1537, 2175]], [[1595, 2190], [1622, 2105], [1682, 2125], [1655, 2210]], [[1327, 2122], [1402, 2095], [1417, 2135], [1342, 2162]], [[1167, 2095], [1207, 2095], [1207, 2137], [1167, 2137]], [[1462, 2087], [1485, 2087], [1485, 2110], [1462, 2110]], [[1525, 2097], [1537, 2070], [1577, 2085], [1565, 2112]], [[1567, 2107], [1637, 2062], [1655, 2092], [1587, 2137]], [[1690, 2300], [1950, 2040], [2045, 2135], [1785, 2395]], [[1685, 2092], [1692, 2052], [1767, 2070], [1757, 2107]], [[1767, 2055], [1830, 2055], [1830, 2112], [1767, 2112]], [[1447, 2050], [1470, 2050], [1470, 2075], [1447, 2075]], [[1307, 2045], [1332, 2045], [1332, 2070], [1307, 2070]], [[2002, 2040], [2027, 2040], [2027, 2067], [2002, 2067]], [[1870, 2022], [1895, 2022], [1895, 2050], [1870, 2050]], [[1145, 2035], [1192, 1990], [1325, 2127], [1280, 2172]], [[1610, 2020], [1652, 2020], [1652, 2060], [1610, 2060]], [[1435, 2015], [1460, 2015], [1460, 2040], [1435, 2040]], [[1677, 2005], [1715, 2005], [1715, 2050], [1677, 2050]], [[2042, 2047], [2052, 1987], [2080, 1992], [2070, 2052]], [[1395, 1985], [1420, 1985], [1420, 2007], [1395, 2007]], [[1317, 2007], [1372, 1977], [1392, 2017], [1337, 2047]], [[2282, 1950], [2307, 1950], [2307, 1975], [2282, 1975]], [[2037, 1937], [2062, 1937], [2062, 1962], [2037, 1962]], [[1860, 1910], [1885, 1897], [1910, 1940], [1885, 1952]], [[1347, 1902], [1375, 1902], [1375, 1930], [1347, 1930]], [[2202, 1895], [2227, 1895], [2227, 1920], [2202, 1920]], [[1137, 1870], [1195, 1870], [1195, 1917], [1137, 1917]], [[1227, 1935], [1267, 1837], [1302, 1852], [1262, 1950]], [[1607, 1815], [1720, 1775], [1740, 1830], [1627, 1872]], [[1917, 1777], [1945, 1777], [1945, 1802], [1917, 1802]], [[1355, 1882], [1440, 1755], [1487, 1785], [1400, 1912]], [[1812, 1730], [1837, 1730], [1837, 1755], [1812, 1755]], [[1427, 1702], [1452, 1702], [1452, 1735], [1427, 1735]], [[1430, 1670], [1457, 1670], [1457, 1695], [1430, 1695]], [[1857, 1665], [1885, 1665], [1885, 1690], [1857, 1690]], [[1005, 1377], [1012, 1350], [1065, 1365], [1057, 1392]], [[805, 1215], [975, 1205], [977, 1255], [807, 1265]], [[737, 1120], [760, 1100], [795, 1140], [772, 1160]], [[587, 1135], [722, 1095], [745, 1167], [610, 1210]], [[860, 1142], [867, 1097], [1052, 1122], [1045, 1170]], [[592, 1067], [637, 1067], [637, 1105], [592, 1105]], [[1052, 1060], [1130, 1060], [1130, 1112], [1052, 1112]], [[495, 995], [550, 995], [550, 1025], [495, 1025]], [[410, 985], [487, 985], [487, 1040], [410, 1040]], [[90, 435], [420, 410], [427, 505], [95, 527]], [[432, 417], [542, 397], [562, 510], [452, 530]]],
    "49_101-55.5_HA_S3_0800.rec.8bit.tif": [[[1402, 2400], [1422, 2315], [1682, 2377], [1662, 2462]], [[1532, 2232], [1610, 2187], [1640, 2240], [1562, 2285]], [[1902, 2132], [1932, 2102], [1950, 2120], [1920, 2150]], [[1707, 2130], [1797, 2082], [1822, 2127], [1732, 2175]], [[1250, 2115], [1270, 2027], [1500, 2080], [1477, 2167]], [[1147, 1985], [1212, 1985], [1212, 2025], [1147, 2025]], [[1960, 1912], [1985, 1912], [1985, 1937], [1960, 1937]], [[1867, 1912], [1905, 1912], [1905, 1942], [1867, 1942]], [[1635, 1950], [1765, 1845], [1955, 2075], [1825, 2180]], [[1230, 1867], [1255, 1867], [1255, 1895], [1230, 1895]], [[1917, 1847], [1980, 1847], [1980, 1892], [1917, 1892]], [[2145, 1815], [2172, 1815], [2172, 1845], [2145, 1845]], [[2107, 1815], [2135, 1815], [2135, 1845], [2107, 1845]], [[2010, 1910], [2055, 1805], [2115, 1832], [2070, 1935]], [[1970, 1747], [2032, 1747], [2032, 1832], [1970, 1832]], [[2047, 1735], [2080, 1707], [2127, 1765], [2092, 1792]], [[1445, 1695], [1492, 1675], [1535, 1777], [1487, 1797]], [[1370, 1675], [1437, 1660], [1465, 1772], [1400, 1787]], [[1525, 1712], [1542, 1652], [1655, 1687], [1635, 1747]], [[1677, 1647], [1745, 1647], [1745, 1697], [1677, 1697]], [[1757, 1655], [1862, 1622], [1932, 1857], [1830, 1887]], [[1267, 1577], [1340, 1567], [1375, 1785], [1305, 1797]], [[642, 1355], [667, 1355], [667, 1380], [642, 1380]], [[650, 1357], [670, 1302], [827, 1357], [810, 1412]], [[917, 1290], [927, 1245], [1065, 1275], [1055, 1320]], [[1100, 1245], [1122, 1245], [1122, 1270], [1100, 1270]], [[1065, 1237], [1092, 1237], [1092, 1260], [1065, 1260]], [[635, 1172], [830, 1132], [845, 1205], [650, 1242]], [[1307, 1137], [1332, 1137], [1332, 1162], [1307, 1162]], [[1030, 1137], [1222, 1127], [1225, 1177], [1032, 1187]], [[282, 1007], [345, 1007], [345, 1035], [282, 1035]], [[1200, 977], [1245, 977], [1245, 1010], [1200, 1010]], [[890, 1075], [975, 932], [1022, 960], [937, 1102]], [[1112, 942], [1135, 897], [1227, 945], [1205, 990]], [[1117, 880], [1142, 880], [1142, 905], [1117, 905]], [[1132, 837], [1157, 837], [1157, 862], [1132, 862]], [[502, 857], [510, 810], [550, 815], [545, 862]], [[637, 802], [665, 802], [665, 827], [637, 827]], [[105, 760], [132, 760], [132, 785], [105, 785]], [[295, 765], [302, 727], [330, 732], [322, 772]], [[137, 732], [192, 732], [192, 770], [137, 770]], [[572, 715], [600, 715], [600, 740], [572, 740]], [[380, 710], [405, 710], [405, 735], [380, 735]], [[652, 695], [680, 695], [680, 720], [652, 720]], [[962, 682], [987, 682], [987, 707], [962, 707]], [[975, 762], [1137, 645], [1175, 695], [1010, 812]], [[382, 672], [415, 672], [415, 697], [382, 697]], [[545, 647], [570, 647], [570, 670], [545, 670]], [[1062, 635], [1085, 635], [1085, 660], [1062, 660]], [[1197, 617], [1232, 617], [1232, 647], [1197, 647]], [[392, 632], [487, 540], [525, 582], [432, 672]], [[1282, 500], [1307, 500], [1307, 525], [1282, 525]], [[372, 520], [457, 485], [482, 545], [397, 580]], [[882, 492], [905, 492], [905, 517], [882, 517]], [[1162, 572], [1177, 445], [1262, 455], [1247, 582]], [[897, 352], [942, 337], [952, 365], [905, 377]], [[810, 332], [835, 332], [835, 355], [810, 355]]],
}

offsets = {
    "38_201-01.2": (100, -50),
    "49_101-55.5": (-50, 0)
}

masks = {
    "38_201-01.2_S1_1950.rec.8bit.tif": "38_201-01.2_S1_1950_MASK_INFILTRATES",
    "38_201-01.2_S1_2000.rec.8bit.tif": "38_201-01.2_S1_2000_MASK_INFILTRATES",
    "38_201-01.2_S1_2050.rec.8bit.tif": "38_201-01.2_S1_2050_MASK_INFILTRATES",
    "38_201-01.2_S1_2100.rec.8bit.tif": "38_201-01.2_S1_2100_MASK_INFILTRATES",
    "38_201-01.2_S2_0100.rec.8bit.tif": "38_201-01.2_S2_100_MASK_INFILTRATES",
    "38_201-01.2_S2_0050.rec.8bit.tif": "38_201-01.2_S2_50_MASK_INFILTRATES", 
    "49_101-55.5_HA_S2_0700.rec.8bit.tif": "49_101-55.5_S2_0700_MASK_INFILTRATES",
    "49_101-55.5_HA_S2_0800.rec.8bit.tif": "49_101-55.5_S2_0800_MASK_INFILTRATES",
    "49_101-55.5_HA_S2_1200.rec.8bit.tif": "49_101-55.5_S2_1200_MASK_INFILTRATES",
    "49_101-55.5_HA_S2_1400.rec.8bit.tif": "49_101-55.5_S2_1400_MASK_INFILTRATES",
    "49_101-55.5_HA_S3_0400.rec.8bit.tif": "49_101-55.5_S3_0400_MASK_INFILTRATES",
    "49_101-55.5_HA_S3_0600.rec.8bit.tif": "49_101-55.5_S3_0600_MASK_INFILTRATES",
    "49_101-55.5_HA_S3_0800.rec.8bit.tif": "49_101-55.5_S3_0800_MASK_INFILTRATES",
}

masks_background = {
    "38_201-01.2_S1_2000.rec.8bit.tif": "38_201-01.2_S1_2000_MASK_BACKGROUND",
    "38_201-01.2_S1_2050.rec.8bit.tif": "38_201-01.2_S1_2050_MASK_BACKGROUND",
    "38_201-01.2_S1_2100.rec.8bit.tif": "38_201-01.2_S1_2100_MASK_BACKGROUND",
    "38_201-01.2_S2_0100.rec.8bit.tif": "38_201-01.2_S2_100_MASK_BACKGROUND",
    "38_201-01.2_S2_0050.rec.8bit.tif": "38_201-01.2_S2_50_MASK_BACKGROUND", 
    "49_101-55.5_HA_S2_0700.rec.8bit.tif": "49_101-55.5_S2_0700_MASK_BACKGROUND",
    "49_101-55.5_HA_S2_0800.rec.8bit.tif": "49_101-55.5_S2_0800_MASK_BACKGROUND",
    "49_101-55.5_HA_S2_1400.rec.8bit.tif": "49_101-55.5_S2_1400_MASK_BACKGROUND",
    "49_101-55.5_HA_S3_0400.rec.8bit.tif": "49_101-55.5_S3_0400_MASK_BACKGROUND",
    "49_101-55.5_HA_S3_0600.rec.8bit.tif": "49_101-55.5_S3_0600_MASK_BACKGROUND",
    "49_101-55.5_HA_S3_0800.rec.8bit.tif": "49_101-55.5_S3_0800_MASK_BACKGROUND",
}

def get_mask(image):
    image = os.path.split(image)[1]
    if image in masks:
        return masks[image]
    return None

def get_mask_background(image):
    image = os.path.split(image)[1]
    if image in masks_background:
        return masks_background[image]
    return None

def position_difference_between_images(image1, image2):
    """Returns the distance between two images, based on their filenames, in terms of numbers, it would be img2 - img1"""

    if image1 == image2:
        return 0
    if image1[:6] != image2[:6]:
        return np.inf

    # Extract the coordinates from the filenames
    def extract_coodrinates(image):
        s, idx = image.split("_")[-2:]
        s = int(s[1:])
        idx = int(idx.split(".")[0])
        return s, idx
    
    s1, idx1 = extract_coodrinates(image1)
    s2, idx2 = extract_coodrinates(image2)

    return idx2 + (s2 - s1) * 2150 - idx1

    # if s1 == s2:
    #     return idx2 - idx1  
    # elif s2 > s1:
    #     return idx2 + (s2 - s1) * 2150 - idx1
    # else:#s1 > s2
    #     return -(idx1 + 2150 - idx2)

def area(bb):
    x, y, w, h = bb
    return w * h

def circumference(bb):
    x, y, w, h = bb
    return 2 * (w + h)

def bb_in_image(bbs, distance):
    """Returns the bounding boxes whose cube defined by width and height is within the distance of the image. bbs parameter is the list of bounding boxes to check"""
    ret_bbs = []
    for bb in bbs:
        x, y, w, h = bb
        d = max(w,h)
        if distance < d / 2:
            ret_bbs.append(bb)
    return ret_bbs

def patches_bbs_for_image(img_size, patch_size, stride):
    grid = img_size // stride
    bbs = []
    for i in range(grid):
        for j in range(grid):
            bbs.append((i * stride, j * stride, patch_size, patch_size))
    return bbs

def select_patches(bbs, bbs2, t=0.05):
    if len(bbs2) == 0:
        return [], bbs
    
    selected = []
    for bb in bbs:
        for bb2 in bbs2:
            if bb_iou(bb, bb2) > t:
                selected.append(bb)
                break

    unselected = []
    for bb in bbs:
        if bb not in selected:
            unselected.append(bb)
    return selected, unselected

def annotate_patches(image, image_size=2560, patch_size=256, stride=None, t=0.05):
    bbs = bbs_for_image(image)
    if stride is None:
        stride = patch_size
    patches = patches_bbs_for_image(image_size, patch_size, stride)
    selected, unselected = select_patches(patches, bbs, t=t)
    return selected, unselected

def image_patches(image, bbs, ps=256):
    if ps is None:
        ps = bbs[0][2]
    patches = np.zeros((len(bbs), ps, ps))
    for i,(x, y, w, h) in enumerate(bbs):
        patches[i,:,:] = image[y:y+h, x:x+w]
    return patches

def bbs_for_image(image):
    image = os.path.split(image)[1]
    if image in bounding_boxes:
        return bounding_boxes[image]
    
    other_images = [img for img in bounding_boxes.keys() if img[:6] == image[:6]]
    distances = [np.abs(position_difference_between_images(image, img)) for img in other_images]
    indices = np.argsort(distances)

    ret_bbs = []
    for i in indices:
        distance = distances[i]
        if distance == np.inf:
            break
        bbs = bounding_boxes[other_images[i]]
        bbs = bb_in_image(bbs, distance)
        ret_bbs.extend(bbs)

    #TODO: Add Filtering bbs that are consumed by other bbs
    return ret_bbs 
    

def bb_iou(a,b):
    # Defines a similarity measure between two bounding boxes based on overlap
    # The similarity measure is the area of the intersection of the two bounding boxes
    # divided by the area of the union of the two bounding boxes

    # Calculate the area of the intersection of the two bounding boxes
    x1 = max(a[0], b[0])
    y1 = max(a[1], b[1])
    x2 = min(a[0] + a[2], b[0] + b[2])
    y2 = min(a[1] + a[3], b[1] + b[3])
    intersection = max(0, x2 - x1) * max(0, y2 - y1)

    # Calculate the area of the union of the two bounding boxes
    area_a = a[2] * a[3]
    area_b = b[2] * b[3]
    union = area_a + area_b - intersection

    # Calculate the similarity measure
    similarity = intersection / union

    return similarity

def scale_bb(bb, original_image_size, new_image_size):
    # Scales a bounding box from the original image size to the new image size
    # The bounding box is represented as a tuple (x, y, w, h) where (x, y) is the
    # top-left corner of the bounding box and (w, h) is the width and height of
    # the bounding box
    x, y, w, h = bb
    x = int(x * new_image_size[0] / original_image_size[0])
    y = int(y * new_image_size[1] / original_image_size[1])
    w = int(w * new_image_size[0] / original_image_size[0])
    h = int(h * new_image_size[1] / original_image_size[1])
    return (x, y, w, h)

def shift_bb(bb, shift):
    # Shifts a bounding box by a given amount
    # The bounding box is represented as a tuple (x, y, w, h) where (x, y) is the
    # top-left corner of the bounding box and (w, h) is the width and height of
    # the bounding box
    x, y, w, h = bb
    x += shift[0]
    y += shift[1]
    return (x, y, w, h)


###RECTANGLES

def scale_min_rect(r, original_image_size, new_image_size):
    # Scales a minimum bounding rectangle from the original image size to the new image size
    # The minimum bounding rectangle is represented as a numpy array of four points (4x2)
    return (r * np.array([new_image_size[0] / original_image_size[0], new_image_size[1] / original_image_size[1]])).astype(int)

def shift_min_rect(r, shift):
    # Shifts a minimum bounding rectangle by a given amount
    # The minimum bounding rectangle is represented as a numpy array of four points (4x2)
    return r + np.array([shift[0], shift[1]])

def bb_to_rect(bb):
    # Converts a bounding box to a minimum bounding rectangle
    # The bounding box is represented as a tuple (x, y, w, h) where (x, y) is the
    # top-left corner of the bounding box and (w, h) is the width and height of
    # the bounding box
    x, y, w, h = bb
    return np.array([[x, y], [x + w, y], [x + w, y + h], [x, y + h]])

def min_rect_iou(a,b):
    # Calculates the intersection over union of two minimum bounding rectangles
    # The minimum bounding rectangles are represented as numpy arrays of four points (4x2)
    # The intersection over union is calculated as the area of the intersection of the two
    # rectangles divided by the area of the union of the two rectangles
    aa = cv2.minAreaRect(a)#a[0].astype(float), a[1].astype(float), a[2].astype(float))
    bb = cv2.minAreaRect(b)#b[0].astype(float), b[1].astype(float), b[2].astype(float))
    intersection = cv2.rotatedRectangleIntersection(aa, bb)[1]
    if intersection is not None:
        intersection = cv2.contourArea(intersection)
    else:
        intersection = 0
    area_a = cv2.contourArea(a)
    area_b = cv2.contourArea(b)
    union = area_a + area_b - intersection
    return intersection / union

def min_rects_for_image(image, max_distance=20):
    image = os.path.split(image)[1]
    if image in rectangles:
        return rectangles[image]
    
    other_images = [img for img in rectangles.keys() if img[:6] == image[:6]]
    distances = [np.abs(position_difference_between_images(image, img)) for img in other_images]
    distances = [d for d in distances if d < max_distance]
    if len(distances) == 0:
        return []
    indices = np.argsort(distances)

    i = indices[0]
    rects = rectangles[other_images[i]]
    return rects

def select_patches_rects(bbs, rects, t=0.05):
    if len(rects) == 0:
        return [], bbs
    
    selected = []
    for bb in bbs:
        bbr = bb_to_rect(bb)
        for bb2 in rects:
            if min_rect_iou(bbr, np.array(bb2)) > t:
                selected.append(bb)
                break

    unselected = []
    for bb in bbs:
        if bb not in selected:
            unselected.append(bb)
    return selected, unselected


def annotate_patches_rects(image, image_size=2560, patch_size=256, stride=None, t=0.05):
    rects = min_rects_for_image(image)
    if stride is None:
        stride = patch_size
    patches = patches_bbs_for_image(image_size, patch_size, stride)
    selected, unselected = select_patches_rects(patches, rects, t=t)
    return selected, unselected